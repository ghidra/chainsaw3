package chainsaw.object{	import flash.net.URLLoader;	import flash.net.URLRequest;	import flash.events.Event;		import chainsaw.math.matrix4;	import chainsaw.object.geometry;	import chainsaw.object.scene;	public class obj extends geometry	{		public var _scn:	scene;		private var _loader	:	URLLoader;								//loader to hold loaded data					public var _obj		:	Array = new Array();					//array to hold the objects in obj				public function obj(scn:scene,src:String):void		{						scn._finished=false;			this._scn = scn;			this._loader 	=	new URLLoader();			this._loader.addEventListener( Event.COMPLETE, parseobj );			this._loader.load( new URLRequest( "obj/"+src+".obj" ) );		}				private function parseobj(evt:Event):void{			var objgeo:Array	=	this._loader.data.split("# Hierarchy");	//split obj file at eash individual object			var ov:Number = 1;//start count verts so each obejcet calls the right very in poly equation						objgeo.shift();//drop the first bit			for(var i in objgeo){				var verts:Array = objgeo[i].split("\n"+"v"+" ");	//split off the vertices				verts.shift();//drop first part				var vtemp:Array = verts[verts.length-1].split("#");	//clip of extra info on last var				verts[verts.length-1]=vtemp[0];						//put clipped value back on								var faces:Array = objgeo[i].split("\n"+"f"+" ");	//split off the faces				faces.shift();				var ftemp:Array = faces[faces.length-1].split("#");				faces[faces.length-1] = ftemp[0];								this._obj.push( new geometry() );			//this._obj[0]    create a new geomotry, put it into an array to hold more than one				//-----------------------------------------------------go through verts				for(var v in verts){					var objv:Array = verts[v].split(" ");			//split at the spaces					var temp2:Array = objv[objv.length-1].split("\r");//split last value to get rid of extra info					var temp3:Array = temp2[0].split("\n");		//for the last vert take off that last new line// bug from loading in a cube, crazy head worked					objv[objv.length-1]=temp3[0];					//re assign last value without crap on end //trace(objv[0]+"    "+objv[1]+"    "+objv[2])					//trace("i"+i+"	x:"+objv[0]+"	y:"+objv[1]+"	z:"+objv[2])					this._obj[i].addpoint([objv[0],objv[1],objv[2]]);//add point to micro geo					this.addpoint( [objv[0],objv[1],objv[2]] );//add point to obj				}				//-----------------------------------------------------go through faces				for(var f in faces){					var objf:Array = faces[f].split(" ");					var objfn:Array = new Array();					//trace(objf)					for(var f2=0; f2<=objf.length-2; f2++){//-2 to get rid of \r						objf[f2] = objf[f2].split("/");						//trace( (objf[f2][0]-ov) );						objfn.push( (objf[f2][0]-ov) );//i have to subtract 1 because obj starts vert count at 1 not 0					}					this._obj[i].addpoly(objfn,"FF0000");				}				ov+=verts.length;				//-----------------------------------------------------				this._obj[i].find_bounding_sphere();//find the bounding sphere			}			this.find_bounding_sphere();			this._scn.finish();		}	}}